name: Auto Grow Flower Garden

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Get current progress
        id: get_progress
        run: |
          PROGRESS=$(grep -oP 'Progress: \*\*\K[0-9]+' README.md || echo "0")
          echo "CURRENT=$PROGRESS" >> $GITHUB_ENV

      - name: Increment progress
        run: |
          NEW=$((CURRENT + 10))
          if [ $NEW -gt 100 ]; then NEW=100; fi

          # Update progress number
          sed -i "s/Progress: \*\*[0-9]\+\*\*/Progress: **$NEW\/100**/" README.md

          # Update bar
          FILLED=$((NEW / 10))
          EMPTY=$((10 - FILLED))
          BAR=$(printf 'ğŸŒ±%.0s' $(seq 1 $FILLED))$(printf 'âšª%.0s' $(seq 1 $EMPTY))
          sed -i "s/\[.*\] [0-9]\+%/[$BAR] $NEW%/" README.md

          # Flower sequence with custom rhythm (some flowers repeat 1â€“3 times)
          FLOWERS=(ğŸŒ± ğŸŒ± ğŸŒ¿ ğŸŒ¿ ğŸŒ¿ ğŸŒ¾ ğŸŒ· ğŸŒ· ğŸŒ¹ ğŸŒ¹ ğŸŒ¸)
          INDEX=$((NEW / 10))
          FLOWER=${FLOWERS[$INDEX]}
          sed -i "s/Flower: .*/Flower: $FLOWER/" README.md

          # Update status
          if [ $NEW -eq 100 ]; then
            sed -i "s/Status: âš ï¸ Keep Growing/Status: âœ… Bloomed!/" README.md
          fi

      - name: Commit updated README
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "chore: garden grew to $NEW%" || echo "No changes"
          git push

